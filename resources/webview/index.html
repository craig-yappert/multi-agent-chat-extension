<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Security-Policy" content="
		default-src 'none';
		script-src ${cspSource} 'unsafe-inline';
		style-src ${cspSource} 'unsafe-inline';
		img-src ${cspSource} https: data:;
		font-src ${cspSource};
		connect-src ${cspSource} https:;
	">
	<link rel="stylesheet" href="${styleUri}">
	<title>Multi Agent Chat</title>
</head>
<body>
	<div class="header">
		<div style="display: flex; align-items: center;">
			<h2 id="chatTitle">Multi Agent Chat</h2>
		</div>
		<div style="display: flex; gap: 8px; align-items: center;">
			<div id="sessionStatus" class="session-status" style="display: none;">No session</div>

			<!-- Workflow Mode Selector -->
			<div class="workflow-selector" title="Select workflow mode">
				<select id="workflowMode" class="workflow-dropdown" onchange="changeWorkflowMode(this.value)">
					<option value="direct" title="Single agent handles your request directly">Direct</option>
					<option value="review" title="Create solution, then get peer review">Review</option>
					<option value="brainstorm" title="Multiple agents explore options in parallel">Brainstorm</option>
					<option value="auto" selected title="System chooses best approach">Auto</option>
				</select>
			</div>

			<div class="toolbar-divider"></div>

			<button class="toolbar-btn" id="newSessionBtn" onclick="newSession()" title="New Chat">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M12 5v14M5 12h14"/>
				</svg>
			</button>
			<button class="toolbar-btn" id="historyBtn" onclick="toggleConversationHistory()" title="Chat History">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
					<path d="M3 3v5h5"/>
					<path d="M12 7v5l4 2"/>
				</svg>
			</button>
			<!-- Settings button removed - use Command Palette ‚Üí 'Manage API Keys' for secure key management -->

			<div class="toolbar-divider"></div>

			<button class="toolbar-btn danger" id="stopAllBtn" onclick="emergencyStop()" title="Stop All Agents (Ctrl+Shift+S)">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
				</svg>
			</button>
			<button class="toolbar-btn" id="floatBtn" onclick="floatWindow()" title="Pop Out to Separate Window">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M7 7h10v10"/>
					<path d="M7 17L17 7"/>
				</svg>
			</button>
		</div>
	</div>

	<div id="newChatTopic" class="new-chat-topic" style="display: none;">
		<div class="topic-input-container">
			<h3>New Conversation</h3>
			<input type="text" id="topicInput" class="topic-input" placeholder="Enter a topic for this conversation (optional)" />
			<div class="topic-buttons">
				<button class="btn primary" onclick="startNewChatWithTopic()">Start Chat</button>
				<button class="btn outlined" onclick="cancelNewChat()">Cancel</button>
			</div>
		</div>
	</div>

	<div id="conversationHistory" class="conversation-history" style="display: none;">
		<div class="conversation-header">
			<h3>Conversation History</h3>
			<button class="btn" onclick="toggleConversationHistory()">‚úï Close</button>
		</div>
		<div id="conversationList" class="conversation-list">
			<!-- Conversations will be loaded here -->
		</div>
	</div>

	<!-- Settings panel removed - use Command Palette ‚Üí 'Manage API Keys' for secure key management -->

	<div class="chat-container" id="chatContainer">
		<div class="messages" id="messages"></div>

		<!-- Agent Status Indicator -->
		<div id="agentStatusBar" class="agent-status-bar" style="display: none;">
			<div class="status-indicator">
				<div class="status-spinner" id="statusSpinner" style="display: none;"></div>
				<div class="status-text" id="agentStatusText">Message sent, awaiting response...</div>
			</div>
			<div class="status-agents" id="agentStatusList"></div>
		</div>

		<div class="input-container" id="inputContainer">
			<div class="textarea-container">
				<div class="textarea-wrapper">
					<textarea class="input-field" id="messageInput" placeholder="Type your message or @mention an agent..." rows="1"></textarea>
					<div class="input-controls">
						<div class="left-controls">
							<!-- File attach button -->
							<button class="attach-btn" onclick="selectFiles()" title="Attach files (or paste file paths)">
								üìé
							</button>
						</div>
						<div class="right-controls">
							<button class="send-btn" id="sendBtn" onclick="sendMessage()">
							<div>
							<span>Send </span>
							   <svg
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 24 24"
								width="11"
								height="11"
								>
								<path
									fill="currentColor"
									d="M20 4v9a4 4 0 0 1-4 4H6.914l2.5 2.5L8 20.914L3.086 16L8 11.086L9.414 12.5l-2.5 2.5H16a2 2 0 0 0 2-2V4z"
								></path>
								</svg>
								</div>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Status and cost indicators -->
	<div class="status ready" id="status" style="display: none;">
		<div class="status-indicator"></div>
		<div class="status-text" id="statusText">Initializing...</div>
		<button class="btn stop" id="stopBtn" onclick="stopRequest()" style="display: none;">
			<svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor">
				<path d="M6 6h12v12H6z"/>
			</svg>
			Stop
		</button>
	</div>

	<div id="yoloWarning" class="yolo-warning" style="display: none;">
		‚ö†Ô∏è Yolo Mode Active: Claude Code will auto-approve all tool requests.
	</div>

	<!-- File picker modal -->
	<div id="filePickerModal" class="file-picker-modal" style="display: none;">
		<div class="file-picker-content">
			<div class="file-picker-header">
				<span>Select File</span>
				<input type="text" id="fileSearchInput" placeholder="Search files..." class="file-search-input">
			</div>
			<div id="fileList" class="file-list">
				<!-- Files will be loaded here -->
			</div>
		</div>
	</div>

	<!-- Various modals removed for brevity - they can be added back as needed -->

	<script src="${scriptUri}"></script>
</body>
</html>